<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Flow Mastery Tool - Wealth Factory</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="animations.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
    
    <style>
        /* Simple Email Form Styles */
        .email-section {
            background: linear-gradient(135deg, rgba(194, 155, 60, 0.1) 0%, rgba(212, 168, 83, 0.05) 100%);
            border: 1px solid rgba(194, 155, 60, 0.2);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .email-section h3 {
            color: #C29B3C;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .email-form {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        
        .email-input {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a1a;
            border: 1px solid rgba(194, 155, 60, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 1rem;
            min-width: 250px;
        }
        
        .email-input:focus {
            outline: none;
            border-color: #C29B3C;
            box-shadow: 0 0 0 3px rgba(194, 155, 60, 0.2);
        }
        
        .email-btn {
            background: linear-gradient(135deg, #C29B3C 0%, #D4A853 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .email-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(194, 155, 60, 0.3);
        }
        
        .email-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .current-user {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 1rem;
            color: #10B981;
            font-weight: 600;
        }
        
        .status-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
        }
        
        .status-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10B981;
        }
        
        .status-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }
        
        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #F59E0B;
        }
        
        /* Fix input fields in main form */
        .main-content .premium-input,
        .financial-item .premium-input {
            background: rgba(255, 255, 255, 0.95) !important;
            color: #1a1a1a !important;
            border: 1px solid rgba(194, 155, 60, 0.3);
        }
        
        .main-content .premium-input:focus,
        .financial-item .premium-input:focus {
            background: white !important;
            color: #1a1a1a !important;
            border-color: #C29B3C;
            box-shadow: 0 0 0 3px rgba(194, 155, 60, 0.2);
        }
        
        .main-content .premium-input::placeholder,
        .financial-item .premium-input::placeholder {
            color: #888;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: #10B981; }
        .notification.error { background: #EF4444; }
        .notification.warning { background: #F59E0B; }
        .notification.info { background: #3B82F6; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loader">
            <div class="wealth-logo-loader">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Simple, clean gear with 8 teeth -->
                    <path d="M12 0L14 2L16 1L17 3L19 2L21 4L20 6L22 7L21 9L23 10L22 12L23 14L21 15L22 17L20 18L19 20L17 19L16 21L14 20L12 22L10 20L8 21L7 19L5 20L4 18L6 17L4 15L5 14L3 12L4 10L2 9L3 7L5 6L4 4L6 3L7 1L8 3L10 2L12 0Z" fill="#C29B3C"/>
                    <!-- Center circle -->
                    <circle cx="12" cy="12" r="6" fill="#1a1a1a"/>
                    <!-- Inner circle for W -->
                    <circle cx="12" cy="12" r="4" fill="#C29B3C"/>
                    <!-- Simple W -->
                    <text x="12" y="15" text-anchor="middle" font-family="Lato, Arial, sans-serif" font-size="5" font-weight="700" fill="white">W</text>
                </svg>
                <span style="color: #C29B3C; font-weight: 600; margin-left: 10px; font-family: Lato, Arial, sans-serif; font-size: 20px;">WEALTH FACTORY</span>
            </div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p>Loading your financial dashboard...</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Navigation Header -->
        <nav class="premium-nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <div class="wealth-logo">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- Simple gear outline -->
                            <path d="M12 1L14.5 2.5L17 1L18.5 3.5L21 2L22.5 4.5L24 3L24 6L23 7L24 8L24 11L22.5 9.5L21 12L22.5 14.5L24 13L24 16L23 17L24 18L24 21L22.5 19.5L21 22L18.5 20.5L17 23L14.5 21.5L12 23L9.5 21.5L7 23L5.5 20.5L3 22L1.5 19.5L0 21L0 18L1 17L0 16L0 13L1.5 14.5L3 12L1.5 9.5L0 11L0 8L1 7L0 6L0 3L1.5 4.5L3 2L5.5 3.5L7 1L9.5 2.5L12 1Z" fill="white"/>
                            <!-- Center circle -->
                            <circle cx="12" cy="12" r="5" fill="#1a1a1a"/>
                            <!-- Inner white circle for W -->
                            <circle cx="12" cy="12" r="3.5" fill="white"/>
                            <!-- W letter -->
                            <text x="12" y="14.5" text-anchor="middle" font-family="Arial, sans-serif" font-size="4" font-weight="700" fill="#1a1a1a">W</text>
                        </svg>
                        <span style="color: white; font-weight: 600; margin-left: 8px; font-family: Lato, Arial, sans-serif; font-size: 18px;">WEALTH FACTORY</span>
                    </div>
                </div>
                <div class="nav-actions">
                    <button id="saveToAirtable" class="premium-btn primary">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Save to Cloud</span>
                    </button>
                    <button id="exportPDF" class="premium-btn secondary">
                        <i class="fas fa-file-pdf"></i>
                        <span>Export PDF</span>
                    </button>
                    <button id="shareBtn" class="premium-btn tertiary">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Email Section for Save/Load -->
        <div class="email-section">
            <h3>
                <i class="fas fa-envelope"></i>
                Save & Load Your Data
            </h3>
            <p>Enter your email to save your financial data to the cloud or load previously saved data.</p>
            
            <div class="email-form">
                <input 
                    type="email" 
                    id="userEmail" 
                    class="email-input" 
                    placeholder="Enter your email address"
                    required
                >
                <input 
                    type="text" 
                    id="userName" 
                    class="email-input" 
                    placeholder="Enter your full name"
                    style="min-width: 200px;"
                >
                <button onclick="loadData()" class="email-btn">
                    <i class="fas fa-download"></i>
                    Load Data
                </button>
                <button onclick="saveData()" class="email-btn">
                    <i class="fas fa-save"></i>
                    Save Data
                </button>
            </div>
            
            <div id="statusMessage"></div>
        </div>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">
                        <span class="title-main">Cash Flow Mastery</span>
                        <span class="title-sub">Your Blueprint for Financial Excellence</span>
                    </h1>
                    <p class="hero-description">
                        Transform your financial future with precision analytics and strategic insights. 
                        Build wealth systematically with our premium financial planning platform.
                    </p>
                </div>
                <div class="hero-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="hero-net-worth">$0</div>
                        <div class="stat-label">Net Worth</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="hero-monthly-flow">$0</div>
                        <div class="stat-label">Monthly Cash Flow</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="hero-annual-projection">$0</div>
                        <div class="stat-label">Annual Projection</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tab Navigation -->
            <div class="premium-tabs">
                <div class="tabs-container">
                    <button class="tab-btn active" data-tab="income-statement">
                        <i class="fas fa-chart-line"></i>
                        <span>Income Statement</span>
                        <div class="tab-indicator"></div>
                    </button>
                    <button class="tab-btn" data-tab="balance-sheet">
                        <i class="fas fa-balance-scale"></i>
                        <span>Balance Sheet</span>
                        <div class="tab-indicator"></div>
                    </button>
                    <button class="tab-btn" data-tab="analytics">
                        <i class="fas fa-analytics"></i>
                        <span>Analytics</span>
                        <div class="tab-indicator"></div>
                    </button>
                </div>
            </div>

            <!-- Income Statement Tab -->
            <div id="income-statement" class="tab-content active">
                <div class="content-grid income-grid-new">
                    <!-- Income and Expenses Container -->
                    <div class="income-expenses-container">
                        <!-- Income Section -->
                        <div class="financial-section income-section-top">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-arrow-up"></i>
                                    Monthly Income
                                </h2>
                                <div class="section-total" id="total-income">$0</div>
                            </div>
                            
                            <div class="categories-grid income-categories">
                                <!-- Active Income -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-briefcase"></i> Active Income</h3>
                                        <div class="category-total" id="active-income-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="active-income-container">
                                        <div class="financial-item">
                                            <label>Salary/Wages</label>
                                            <input type="number" class="premium-input" data-field="salary_wages" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Distributions</label>
                                            <input type="number" class="premium-input" data-field="distributions" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Commissions</label>
                                            <input type="number" class="premium-input" data-field="commissions" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Bonus</label>
                                            <input type="number" class="premium-input" data-field="bonus" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Interest Income</label>
                                            <input type="number" class="premium-input" data-field="interest_income" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('active-income')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Income
                                    </button>
                                </div>

                                <!-- Portfolio Income -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-chart-line"></i> Portfolio Income</h3>
                                        <div class="category-total" id="portfolio-income-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="portfolio-income-container">
                                        <div class="financial-item">
                                            <label>Dividends</label>
                                            <input type="number" class="premium-input" data-field="dividends" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Royalties</label>
                                            <input type="number" class="premium-input" data-field="royalties" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('portfolio-income')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Portfolio Income
                                    </button>
                                </div>

                                <!-- Passive Income -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-building"></i> Passive Income</h3>
                                        <div class="category-total" id="passive-income-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="passive-income-container">
                                        <div class="financial-item">
                                            <label>Business Income</label>
                                            <input type="number" class="premium-input" data-field="business_income" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Real Estate Income</label>
                                            <input type="number" class="premium-input" data-field="real_estate_income" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('passive-income')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Passive Income
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Divider -->
                        <div class="section-divider">
                            <div class="divider-line"></div>
                            <div class="divider-text">Monthly Expenses</div>
                            <div class="divider-line"></div>
                        </div>

                        <!-- Expenses Section -->
                        <div class="financial-section expenses-section-bottom">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-arrow-down"></i>
                                    Monthly Expenses
                                </h2>
                                <div class="section-total" id="total-expenses">$0</div>
                            </div>
                            
                            <div class="categories-grid expenses-categories">
                                <!-- House Expenses -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-home"></i> House</h3>
                                        <div class="category-total" id="house-expenses-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="house-expenses-container">
                                        <div class="financial-item">
                                            <label>Mortgage/Rent</label>
                                            <input type="number" class="premium-input" data-field="mortgage_rent" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>HELOC Payment</label>
                                            <input type="number" class="premium-input" data-field="heloc_payment" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>HOA Fees</label>
                                            <input type="number" class="premium-input" data-field="hoa_fees" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Cell Phone #1</label>
                                            <input type="number" class="premium-input" data-field="cell_phone_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Cell Phone #2</label>
                                            <input type="number" class="premium-input" data-field="cell_phone_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Internet/WiFi</label>
                                            <input type="number" class="premium-input" data-field="internet" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Cable/Satellite TV</label>
                                            <input type="number" class="premium-input" data-field="cable_satellite" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Home Security</label>
                                            <input type="number" class="premium-input" data-field="home_security" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Insurance (Home/Renters)</label>
                                            <input type="number" class="premium-input" data-field="home_insurance" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Electricity</label>
                                            <input type="number" class="premium-input" data-field="electricity" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Gas</label>
                                            <input type="number" class="premium-input" data-field="gas" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Water/Sewer</label>
                                            <input type="number" class="premium-input" data-field="water_sewer" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Waste Removal</label>
                                            <input type="number" class="premium-input" data-field="waste_removal" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Repairs/Maintenance</label>
                                            <input type="number" class="premium-input" data-field="repairs_maintenance" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Lawncare/Pest</label>
                                            <input type="number" class="premium-input" data-field="lawncare_pest" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('house-expenses')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom House Expense
                                    </button>
                                </div>

                                <!-- Transportation -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-car"></i> Transportation</h3>
                                        <div class="category-total" id="transportation-expenses-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="transportation-expenses-container">
                                        <div class="financial-item">
                                            <label>Auto Payment #1</label>
                                            <input type="number" class="premium-input" data-field="auto_payment_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto Payment #2</label>
                                            <input type="number" class="premium-input" data-field="auto_payment_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto Insurance</label>
                                            <input type="number" class="premium-input" data-field="auto_insurance" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Registration/Tags</label>
                                            <input type="number" class="premium-input" data-field="registration_tags" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Gas/Fuel</label>
                                            <input type="number" class="premium-input" data-field="gas_fuel" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto Repairs</label>
                                            <input type="number" class="premium-input" data-field="auto_repairs" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('transportation-expenses')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Transportation Expense
                                    </button>
                                </div>

                                <!-- Food -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-utensils"></i> Food</h3>
                                        <div class="category-total" id="food-expenses-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="food-expenses-container">
                                        <div class="financial-item">
                                            <label>Groceries</label>
                                            <input type="number" class="premium-input" data-field="groceries" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Restaurants</label>
                                            <input type="number" class="premium-input" data-field="restaurants" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('food-expenses')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Food Expense
                                    </button>
                                </div>

                                <!-- Entertainment -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-film"></i> Entertainment</h3>
                                        <div class="category-total" id="entertainment-expenses-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="entertainment-expenses-container">
                                        <div class="financial-item">
                                            <label>Streaming</label>
                                            <input type="number" class="premium-input" data-field="streaming" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Music</label>
                                            <input type="number" class="premium-input" data-field="music" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Movies</label>
                                            <input type="number" class="premium-input" data-field="movies" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Concerts</label>
                                            <input type="number" class="premium-input" data-field="concerts" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Sporting Events</label>
                                            <input type="number" class="premium-input" data-field="sporting_events" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Live Theater</label>
                                            <input type="number" class="premium-input" data-field="live_theater" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Outdoor Activities</label>
                                            <input type="number" class="premium-input" data-field="outdoor_activities" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('entertainment-expenses')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Entertainment Expense
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cash Flow Summary -->
                    <div class="financial-section cashflow-section-sidebar">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-exchange-alt"></i>
                                Cash Flow
                            </h2>
                            <div class="section-total" id="monthly-cash-flow">$0</div>
                        </div>
                        
                        <div class="summary-cards-sidebar">
                            <div class="summary-card">
                                <h4>Monthly Summary</h4>
                                <div class="summary-items">
                                    <div class="summary-item">
                                        <span>Total Income</span>
                                        <span id="summary-income">$0</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Total Expenses</span>
                                        <span id="summary-expenses">$0</span>
                                    </div>
                                    <div class="summary-item primary">
                                        <span>Monthly Cash Flow</span>
                                        <span id="summary-cash-flow">$0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Annual Projection</h4>
                                <div class="projection-items">
                                    <div class="projection-item">
                                        <span>Annual Income</span>
                                        <span id="annual-income">$0</span>
                                    </div>
                                    <div class="projection-item">
                                        <span>Annual Expenses</span>
                                        <span id="annual-expenses">$0</span>
                                    </div>
                                    <div class="projection-item primary">
                                        <span>Annual Cash Flow</span>
                                        <span id="annual-cash-flow">$0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Income Distribution</h4>
                                <div class="chart-container">
                                    <canvas id="incomeDistributionChart" width="200" height="200"></canvas>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Expense Breakdown</h4>
                                <div class="chart-container">
                                    <canvas id="expenseDistributionChart" width="200" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Balance Sheet Tab -->
            <div id="balance-sheet" class="tab-content">
                <div class="content-grid balance-grid-new">
                    <!-- Assets and Liabilities Container -->
                    <div class="assets-liabilities-container">
                        <!-- Assets Section -->
                        <div class="financial-section assets-section-top">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-coins"></i>
                                    Assets
                                </h2>
                                <div class="section-total" id="total-assets">$0</div>
                            </div>
                            
                            <div class="categories-grid assets-categories">
                                <!-- Liquid Assets -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-tint"></i> Liquid Assets</h3>
                                        <div class="category-total" id="liquid-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="liquid-assets-container">
                                        <div class="financial-item">
                                            <label>Cash on Hand</label>
                                            <input type="number" class="premium-input" data-field="cash_on_hand" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Personal Checking</label>
                                            <input type="number" class="premium-input" data-field="personal_checking" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Personal Savings</label>
                                            <input type="number" class="premium-input" data-field="personal_savings" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Business Checking</label>
                                            <input type="number" class="premium-input" data-field="business_checking" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Business Savings</label>
                                            <input type="number" class="premium-input" data-field="business_savings" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Money Market Funds</label>
                                            <input type="number" class="premium-input" data-field="money_market" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Certificates of Deposit</label>
                                            <input type="number" class="premium-input" data-field="certificates_deposit" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('liquid-assets')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Liquid Asset
                                    </button>
                                </div>

                                <!-- Investments -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-chart-pie"></i> Investments</h3>
                                        <div class="category-total" id="investments-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="investments-container">
                                        <div class="financial-item">
                                            <label>Business #1</label>
                                            <input type="number" class="premium-input" data-field="business_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Business #2</label>
                                            <input type="number" class="premium-input" data-field="business_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Business #3</label>
                                            <input type="number" class="premium-input" data-field="business_3" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Stocks</label>
                                            <input type="number" class="premium-input" data-field="stocks" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Bonds</label>
                                            <input type="number" class="premium-input" data-field="bonds" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Mutual Funds</label>
                                            <input type="number" class="premium-input" data-field="mutual_funds" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>IRA</label>
                                            <input type="number" class="premium-input" data-field="ira" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>401K</label>
                                            <input type="number" class="premium-input" data-field="401k" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('investments')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Investment
                                    </button>
                                </div>

                                <!-- Personal Use Assets -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-home"></i> Personal Use Assets</h3>
                                        <div class="category-total" id="personal-assets-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="personal-assets-container">
                                        <div class="financial-item">
                                            <label>Primary Residence</label>
                                            <input type="number" class="premium-input" data-field="primary_residence" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto #1</label>
                                            <input type="number" class="premium-input" data-field="auto_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto #2</label>
                                            <input type="number" class="premium-input" data-field="auto_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Other Personal Assets</label>
                                            <input type="number" class="premium-input" data-field="other_personal_assets" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('personal-assets')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Personal Asset
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Divider -->
                        <div class="section-divider">
                            <div class="divider-line"></div>
                            <div class="divider-text">Liabilities</div>
                            <div class="divider-line"></div>
                        </div>

                        <!-- Liabilities Section -->
                        <div class="financial-section liabilities-section-bottom">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-minus-circle"></i>
                                    Liabilities
                                </h2>
                                <div class="section-total" id="total-liabilities">$0</div>
                            </div>
                            
                            <div class="categories-grid liabilities-categories">
                                <!-- Short-term Liabilities -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-clock"></i> Short-term Liabilities</h3>
                                        <div class="category-total" id="short-term-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="short-term-liabilities-container">
                                        <div class="financial-item">
                                            <label>Medical/Dental</label>
                                            <input type="number" class="premium-input" data-field="medical_dental" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Credit Card #1</label>
                                            <input type="number" class="premium-input" data-field="credit_card_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Credit Card #2</label>
                                            <input type="number" class="premium-input" data-field="credit_card_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Credit Card #3</label>
                                            <input type="number" class="premium-input" data-field="credit_card_3" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Credit Card #4</label>
                                            <input type="number" class="premium-input" data-field="credit_card_4" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Credit Card #5</label>
                                            <input type="number" class="premium-input" data-field="credit_card_5" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('short-term-liabilities')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Short-term Liability
                                    </button>
                                </div>

                                <!-- Long-term Liabilities -->
                                <div class="category-card expanded">
                                    <div class="category-header">
                                        <h3><i class="fas fa-calendar-alt"></i> Long-term Liabilities</h3>
                                        <div class="category-total" id="long-term-total">$0</div>
                                    </div>
                                    <div class="items-container expanded-items" id="long-term-liabilities-container">
                                        <div class="financial-item">
                                            <label>Primary Mortgage</label>
                                            <input type="number" class="premium-input" data-field="primary_mortgage" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>HELOC</label>
                                            <input type="number" class="premium-input" data-field="heloc" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Investment Mortgage</label>
                                            <input type="number" class="premium-input" data-field="investment_mortgage" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto Loan #1</label>
                                            <input type="number" class="premium-input" data-field="auto_loan_1" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Auto Loan #2</label>
                                            <input type="number" class="premium-input" data-field="auto_loan_2" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Student Loans</label>
                                            <input type="number" class="premium-input" data-field="student_loans" step="0.01" placeholder="0.00">
                                        </div>
                                        <div class="financial-item">
                                            <label>Personal Loans Balance</label>
                                            <input type="number" class="premium-input" data-field="personal_loans_balance" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                    <button class="add-item-btn" onclick="addCustomItem('long-term-liabilities')">
                                        <i class="fas fa-plus"></i>
                                        Add Custom Long-term Liability
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Net Worth Summary -->
                    <div class="financial-section summary-section-sidebar">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-trophy"></i>
                                Net Worth
                            </h2>
                            <div class="section-total" id="net-worth">$0</div>
                        </div>
                        
                        <div class="summary-cards-sidebar">
                            <div class="summary-card">
                                <h4>Balance Summary</h4>
                                <div class="summary-items">
                                    <div class="summary-item">
                                        <span>Total Assets</span>
                                        <span id="summary-assets">$0</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Total Liabilities</span>
                                        <span id="summary-liabilities">$0</span>
                                    </div>
                                    <div class="summary-item primary">
                                        <span>Net Worth</span>
                                        <span id="summary-net-worth">$0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Asset Allocation</h4>
                                <div class="chart-container">
                                    <canvas id="assetAllocationChart" width="200" height="200"></canvas>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Liability Breakdown</h4>
                                <div class="chart-container">
                                    <canvas id="liabilityBreakdownChart" width="200" height="200"></canvas>
                                </div>
                            </div>

                            <div class="summary-card">
                                <h4>Key Ratios</h4>
                                <div class="summary-items">
                                    <div class="summary-item">
                                        <span>Debt-to-Asset</span>
                                        <span id="debt-to-asset-ratio">0%</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Liquidity Ratio</span>
                                        <span id="liquidity-ratio">0%</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Savings Rate</span>
                                        <span id="savings-rate">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="analytics-dashboard">
                    <div class="analytics-header">
                        <h2>Financial Analytics</h2>
                        <p>Comprehensive insights into your financial health and growth potential</p>
                    </div>

                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3>Income Breakdown</h3>
                            <div class="chart-wrapper">
                                <canvas id="portfolioChart" width="350" height="250"></canvas>
                            </div>
                        </div>

                        <div class="analytics-card">
                            <h3>Expense Analysis</h3>
                            <div class="chart-wrapper">
                                <canvas id="expenseChart" width="350" height="250"></canvas>
                            </div>
                        </div>

                        <div class="analytics-card">
                            <h3>Cash Flow Trend</h3>
                            <div class="chart-wrapper">
                                <canvas id="cashflowChart" width="350" height="250"></canvas>
                            </div>
                        </div>

                        <div class="analytics-card">
                            <h3>Financial Health Score</h3>
                            <div class="health-score">
                                <div class="score-circle">
                                    <span id="health-score">85</span>
                                </div>
                                <div class="score-details">
                                    <div class="score-item">
                                        <span>Debt-to-Income</span>
                                        <span id="debt-income-ratio">25%</span>
                                    </div>
                                    <div class="score-item">
                                        <span>Emergency Fund</span>
                                        <span>3.2 months</span>
                                    </div>
                                    <div class="score-item">
                                        <span>Savings Rate</span>
                                        <span>15%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="analytics-card large">
                            <h3>Wealth Projection (10 Years)</h3>
                            <div class="chart-wrapper">
                                <canvas id="growthChart" width="700" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="utils.js"></script>
    <script src="storage.js"></script>
    <script src="calculations.js"></script>
    <script src="charts.js"></script>
    <script src="airtable-integration.js"></script>
    <script src="app.js"></script>

    <!-- Simple Save/Load Functions -->
    <script>
        // Simple Airtable Integration
        const AIRTABLE_BASE_ID = 'appBJSpCa8ue7cqiA';
        const AIRTABLE_API_KEY = 'patm8ZuPbmf2JVGX6.9b1907acddb8cea5400ae18009490f5cc6d6f087433ad394cf9bbad2a731e268';
        const AIRTABLE_TABLE = 'Students';
        const AIRTABLE_URL = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE}`;
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // Show status message
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
        }
        
        // Get current form data
        function getCurrentData() {
            const data = {};
            let hasData = false;
            
            document.querySelectorAll('[data-field]').forEach(input => {
                const value = parseFloat(input.value) || 0;
                if (value !== 0) {
                    data[input.dataset.field] = value;
                    hasData = true;
                }
            });
            
            return { data, hasData };
        }
        
        // Set form data
        function setFormData(data) {
            Object.entries(data).forEach(([field, value]) => {
                const input = document.querySelector(`[data-field="${field}"]`);
                if (input) {
                    input.value = value;
                }
            });
            
            // Trigger calculations if app is loaded
            if (window.app) {
                window.app.calculateAll();
            }
        }
        
        // Auto-save function (debounced)
        let autoSaveTimeout;
        function scheduleAutoSave() {
            const email = document.getElementById('userEmail').value.trim();
            const name = document.getElementById('userName').value.trim();
            
            // Only auto-save if we have email and name
            if (!email || !name) return;
            
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                autoSaveData();
            }, 3000); // Wait 3 seconds after user stops typing
        }
        
        // Auto-save data quietly
        async function autoSaveData() {
            const email = document.getElementById('userEmail').value.trim();
            const name = document.getElementById('userName').value.trim();
            
            if (!email || !name) return;
            
            const { data: currentData, hasData } = getCurrentData();
            
            try {
                // Save even if form is empty (just email/name)
                const searchUrl = `${AIRTABLE_URL}?filterByFormula={Email}='${email}'`;
                
                const searchResponse = await fetch(searchUrl, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!searchResponse.ok) return;
                
                const searchData = await searchResponse.json();
                
                const record = {
                    fields: {
                        'Email': email,
                        'Name': name,
                        'Last Updated': new Date().toISOString(),
                        'Financial Data': JSON.stringify(currentData),
                        'Net Worth': calculateNetWorth(currentData),
                        'Monthly Cash Flow': calculateMonthlyCashFlow(currentData),
                        'Source': 'simple_app_autosave'
                    }
                };
                
                let response;
                if (searchData.records.length > 0) {
                    // Update existing record
                    const recordId = searchData.records[0].id;
                    response = await fetch(`${AIRTABLE_URL}/${recordId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(record)
                    });
                } else {
                    // Create new record
                    response = await fetch(AIRTABLE_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ records: [record] })
                    });
                }
                
                if (response.ok && hasData) {
                    // Only show notification if there's actual financial data
                    showNotification('ðŸ’¾ Auto-saved!', 'success');
                }
                
            } catch (error) {
                console.error('Auto-save error:', error);
            }
        }
        
        // Save data to Airtable
        async function saveData() {
            const email = document.getElementById('userEmail').value.trim();
            const name = document.getElementById('userName').value.trim();
            
            if (!email) {
                showNotification('Please enter your email address', 'error');
                showStatus('âŒ Please enter your email address', 'error');
                return;
            }
            
            if (!email.includes('@')) {
                showNotification('Please enter a valid email address', 'error');
                showStatus('âŒ Please enter a valid email address', 'error');
                return;
            }
            
            if (!name) {
                showNotification('Please enter your full name', 'error');
                showStatus('âŒ Please enter your full name', 'error');
                return;
            }
            
            const { data: currentData, hasData } = getCurrentData();
            
            if (!hasData) {
                showNotification('Please fill out some financial information first, then save your data', 'warning');
                showStatus('ðŸ’¡ Fill out some financial fields below, then click Save Data', 'warning');
                return;
            }
            
            showStatus('Saving data to Airtable...', 'info');
            
            try {
                // Simplified search - avoid special characters in filter
                const encodedEmail = encodeURIComponent(email);
                const searchUrl = `${AIRTABLE_URL}?filterByFormula=FIND("${email}",{Email})`;
                
                console.log('Searching for user...', searchUrl);
                
                const searchResponse = await fetch(searchUrl, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Search response status:', searchResponse.status);
                
                if (!searchResponse.ok) {
                    const errorText = await searchResponse.text();
                    console.error('Search error:', errorText);
                    throw new Error(`Search failed: ${searchResponse.status} - ${errorText}`);
                }
                
                const searchData = await searchResponse.json();
                console.log('Search results:', searchData);
                
                // Create clean record data
                const record = {
                    fields: {
                        'Email': email,
                        'Name': name,
                        'Last Updated': new Date().toISOString(),
                        'Financial Data': JSON.stringify(currentData),
                        'Net Worth': Math.round(calculateNetWorth(currentData) * 100) / 100,
                        'Monthly Cash Flow': Math.round(calculateMonthlyCashFlow(currentData) * 100) / 100,
                        'Source': 'simple_app'
                    }
                };
                
                console.log('Record to save:', record);
                
                let response;
                if (searchData.records && searchData.records.length > 0) {
                    // Update existing record
                    const recordId = searchData.records[0].id;
                    console.log('Updating existing record:', recordId);
                    
                    response = await fetch(`${AIRTABLE_URL}/${recordId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(record)
                    });
                } else {
                    // Create new record
                    console.log('Creating new record');
                    
                    response = await fetch(AIRTABLE_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ records: [record] })
                    });
                }
                
                console.log('Save response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Save successful:', result);
                    showStatus('âœ… Data saved successfully!', 'success');
                    showNotification('Data saved to Airtable successfully!', 'success');
                } else {
                    const errorData = await response.text();
                    console.error('Save failed:', errorData);
                    throw new Error(`Save failed: ${response.status} - ${errorData}`);
                }
                
            } catch (error) {
                console.error('Save error:', error);
                showStatus(`âŒ Save failed: ${error.message}`, 'error');
                showNotification('Failed to save data. Please try again.', 'error');
            }
        }
        
        // Load data from Airtable
        async function loadData() {
            const email = document.getElementById('userEmail').value.trim();
            
            if (!email) {
                showNotification('Please enter your email address', 'error');
                return;
            }
            
            if (!email.includes('@')) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            showStatus('Loading data from Airtable...', 'info');
            
            try {
                const searchUrl = `${AIRTABLE_URL}?filterByFormula={Email}='${email}'`;
                
                const response = await fetch(searchUrl, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Load failed: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.records.length > 0) {
                    const record = data.records[0];
                    const financialData = JSON.parse(record.fields['Financial Data'] || '{}');
                    
                    // Load the name too
                    document.getElementById('userName').value = record.fields['Name'] || '';
                    
                    setFormData(financialData);
                    
                    const lastUpdated = new Date(record.fields['Last Updated']).toLocaleDateString();
                    showStatus(`âœ… Data loaded successfully! Last updated: ${lastUpdated}`, 'success');
                    showNotification('Data loaded from Airtable!', 'success');
                } else {
                    showStatus('No saved data found for this email address.', 'warning');
                    showNotification('No saved data found for this email.', 'warning');
                }
                
            } catch (error) {
                console.error('Load error:', error);
                showStatus(`âŒ Load failed: ${error.message}`, 'error');
                showNotification('Failed to load data. Please try again.', 'error');
            }
        }
        
        // Simple calculations
        function calculateNetWorth(data) {
            const assets = calculateTotal(data, [
                'cash_on_hand', 'personal_checking', 'personal_savings', 'business_checking', 'business_savings',
                'money_market', 'certificates_deposit', 'business_1', 'business_2', 'business_3',
                'stocks', 'bonds', 'mutual_funds', 'ira', '401k', 'primary_residence', 'auto_1', 'auto_2', 'other_personal_assets'
            ]);
            
            const liabilities = calculateTotal(data, [
                'medical_dental', 'credit_card_1', 'credit_card_2', 'credit_card_3', 'credit_card_4', 'credit_card_5',
                'primary_mortgage', 'heloc', 'investment_mortgage', 'auto_loan_1', 'auto_loan_2', 'student_loans', 'personal_loans_balance'
            ]);
            
            return assets - liabilities;
        }
        
        function calculateMonthlyCashFlow(data) {
            const income = calculateTotal(data, [
                'salary_wages', 'distributions', 'commissions', 'bonus', 'interest_income',
                'dividends', 'royalties', 'business_income', 'real_estate_income'
            ]);
            
            const expenses = calculateTotal(data, [
                'mortgage_rent', 'heloc_payment', 'hoa_fees', 'cell_phone_1', 'cell_phone_2',
                'internet', 'cable_satellite', 'home_security', 'home_insurance', 'electricity', 'gas',
                'water_sewer', 'waste_removal', 'repairs_maintenance', 'lawncare_pest',
                'auto_payment_1', 'auto_payment_2', 'auto_insurance', 'registration_tags', 'gas_fuel', 'auto_repairs',
                'groceries', 'restaurants', 'streaming', 'music', 'movies', 'concerts', 'sporting_events',
                'live_theater', 'outdoor_activities'
            ]);
            
            return income - expenses;
        }
        
        function calculateTotal(data, fields) {
            return fields.reduce((sum, field) => sum + (data[field] || 0), 0);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Remove loading screen
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                const appContainer = document.getElementById('app');
                
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                if (appContainer) {
                    appContainer.style.display = 'block';
                }
            }, 1000);
            
            // Add event listeners
            document.getElementById('saveToAirtable').addEventListener('click', saveData);
            
            // Add auto-save listeners to all financial inputs
            document.querySelectorAll('[data-field]').forEach(input => {
                input.addEventListener('input', scheduleAutoSave);
                input.addEventListener('change', scheduleAutoSave);
            });
            
            // Add listeners to email and name fields
            document.getElementById('userEmail').addEventListener('input', scheduleAutoSave);
            document.getElementById('userName').addEventListener('input', scheduleAutoSave);
            
            // Test connection on load
            setTimeout(() => {
                fetch(`${AIRTABLE_URL}?maxRecords=1`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                    }
                }).then(response => {
                    if (response.ok) {
                        console.log('âœ… Airtable connection working');
                    } else {
                        console.error('âŒ Airtable connection failed');
                        showNotification('Warning: Could not connect to Airtable', 'warning');
                    }
                });
            }, 2000);
        });
    </script>
</body>
</html>
